#include <stdio.h>
#include <conio.h>

char arr[18][3] = {
    {'E', '+', 'F'}, {'E', '*', 'F'}, {'E', '(', 'F'}, {'E', ')', 'F'},
    {'E', 'i', 'F'}, {'E', '$', 'F'}, {'F', '+', 'F'}, {'F', '*', 'F'},
    {'F', '(', 'F'}, {'F', ')', 'F'}, {'F', 'i', 'F'}, {'F', '$', 'F'},
    {'T', '+', 'F'}, {'T', '*', 'F'}, {'T', '(', 'F'}, {'T', ')', 'F'},
    {'T', 'i', 'F'}, {'T', '$', 'F'}
};

char prod[] = "EETTFF";

char res[6][3] = {
    {'E', '+', 'T'},
    {'T', '\0', '\0'},
    {'T', '*', 'F'},
    {'F', '\0', '\0'},
    {'(', 'E', ')'},
    {'i', '\0', '\0'}
};

char stack[20][2];
int top = -1;


/* Mark TRAILING terminal for a non-terminal */
void install(char pro, char re)
{
    int i;
    for (i = 0; i < 18; ++i)
    {
        if (arr[i][0] == pro && arr[i][1] == re)
        {
            arr[i][2] = 'T';
            ++top;
            stack[top][0] = pro;
            stack[top][1] = re;
            break;
        }
    }
}


int main()
{
    int i, j;
    char pro, re, prev = ' ';

    /* Step 1: Direct TRAILING symbols */
    for (i = 0; i < 6; ++i)
    {
        for (j = 2; j >= 0; --j)
        {
            /* If terminal appears last in RHS, install it */
            if (res[i][j] == '+' || res[i][j] == '*' || res[i][j] == '(' ||
                res[i][j] == ')' || res[i][j] == 'i' || res[i][j] == '$')
            {
                install(prod[i], res[i][j]);
                break;
            }

            /* If last is Nonterminal and before it is terminal */
            else if (res[i][j] == 'E' || res[i][j] == 'F' || res[i][j] == 'T')
            {
                if (j > 0 && (res[i][j-1] == '+' || res[i][j-1] == '*' ||
                    res[i][j-1] == '(' || res[i][j-1] == ')' ||
                    res[i][j-1] == 'i' || res[i][j-1] == '$'))
                {
                    install(prod[i], res[i][j - 1]);
                    break;
                }
            }
        }
    }

    /* Step 2: Propagate TRAILING through grammar */
    while (top >= 0)
    {
        pro = stack[top][0];
        re = stack[top][1];
        --top;

        for (i = 0; i < 6; ++i)
        {
            if (res[i][0] == pro && res[i][0] != prod[i])
            {
                install(prod[i], re);
            }
        }
    }

    /* Print the table */
    for (i = 0; i < 18; ++i)
    {
        printf("\n\t");
        for (j = 0; j < 3; ++j)
            printf("%c\t", arr[i][j]);
    }

    printf("\n\n");

    /* Print TRAILING sets */
    for (i = 0; i < 18; ++i)
    {
        if (prev != arr[i][0])
        {
            prev = arr[i][0];
            printf("\n\t%c -> ", prev);
        }

        if (arr[i][2] == 'T')
            printf("%c ", arr[i][1]);
    }

    getch();
    return 0;
}
