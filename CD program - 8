#include <stdio.h>
#include <ctype.h>
#include <string.h>

char keywords[][10] = {
    "main","auto","break","case","char","const","continue","default",
    "do","double","else","enum","extern","float","for","goto",
    "if","int","long","register","return","short","signed",
    "sizeof","static","struct","switch","typedef",
    "unsigned","void","printf","while"
};

int isKeyword(char word[]) {
    for (int i = 0; i < 32; i++)
        if (strcmp(keywords[i], word) == 0)
            return 1;
    return 0;
}

int main() {

    FILE *fp = fopen("flex_input.txt", "r");
    if (!fp) {
        printf("File not found!\n");
        return 0;
    }

    char ch, buffer[20];
    int j = 0;

    while ((ch = fgetc(fp)) != EOF) {

        // Skip comments
        if (ch == '/') {
            char next = fgetc(fp);
            if (next == '/') {  // single line comment
                while (ch != '\n') ch = fgetc(fp);
                continue;
            }
            else if (next == '*') {  // multi-line comment
                while (!(ch == '*' && next == '/')) {
                    ch = next;
                    next = fgetc(fp);
                }
                continue;
            }
            else {
                printf("%c is operator\n", ch);
                ch = next;
            }
        }

        // If operator
        if (ch == '+' || ch == '-' || ch == '*' || ch == '%' || ch == '=') {
            printf("%c is operator\n", ch);
        }

        // Build keywords/identifiers
        if (isalnum(ch)) {
            buffer[j++] = ch;
        }
        else {
            if (j != 0) {
                buffer[j] = '\0';
                j = 0;

                if (isKeyword(buffer))
                    printf("%s is keyword\n", buffer);
                else
                    printf("%s is identifier\n", buffer);
            }
        }
    }

    fclose(fp);
    return 0;
}
